#pragma config(Sensor, dgtl3,  chooSwitch,     sensorDigitalIn)
#pragma config(Motor,  port1,           choo1,         tmotorVex393_HBridge, openLoop, reversed)
#pragma config(Motor,  port3,           dingus,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port4,           right1,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port5,           left1,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port6,           left2,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port7,           choo2,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port8,           wingus,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port10,          right2,        tmotorVex393_HBridge, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

enum catapultState { REST, FIRING, MANUAL_OVERRIDE };
catapultState chooState = FIRING;

int chooSpeed;

int rightSpeed = 0;
int leftSpeed = 0;
int lr = 0;
int fb = 0;

void setFeedSpeed(int speed)
{
	motor[wingus] = speed;
	motor[dingus] = speed;
}

void setChooSpeed(int speed)
{
	motor[choo1] = speed;
	motor[choo2] = speed;
}

void setDriveSpeed(int right, int left)
{
	motor[right1] = right;
	motor[right2] = right;
	motor[left1] = left;
	motor[left2] = left;

	rightSpeed = right;
	leftSpeed = left;
}

void feedControl()
{
	if (vexRT[Btn6U] == 1)
	{
		setFeedSpeed(127);
	}
	else if (vexRT[Btn6D] == 1)
	{
		setFeedSpeed(-127);
	}
	else
	{
		setFeedSpeed(0);
	}
}

void cataChooChoo()
{
	if (chooState == FIRING && SensorValue[chooSwitch] == 0 && time1[T2] > 750)
	{
		chooState = REST;
	}
	else if (chooState == REST && vexRT[Btn5U] == 1)
	{
		chooState = FIRING;
		clearTimer(T2);
	}
	else if (chooState == MANUAL_OVERRIDE && vexRT[Btn5D] == 0)
	{
		chooState = REST;
	}

	if (vexRT[Btn5D] == 1)
	{
		chooState = MANUAL_OVERRIDE;
	}

	switch (chooState)
	{
	case REST:
		chooSpeed = 20;
		break;
	case FIRING:
		chooSpeed = 127;
		break;
	case MANUAL_OVERRIDE:
		chooSpeed = 127;
		break;
	default:
		chooSpeed = 20;
	}

	setChooSpeed(chooSpeed);
}

void driveControl()
{
	if (vexRT[Ch3] > 50 || vexRT[Ch3] < -50)
	{
		if (vexRT[Ch1] < 50 && vexRT[Ch1] > -50)
		{
			//move straight forward or backward
			setDriveSpeed(vexRT[Ch3], vexRT[Ch3]);
		}
		else
		{
			//angled turn
			lr = vexRT[Ch1];
			fb = vexRT[Ch3];
			//make it work
			setDriveSpeed(vexRT[Ch3] * vexRT[Ch3] / vexRT[Ch1] / 16129, -vexRT[Ch3] / vexRT[Ch1]);
		}
	}
	else if (vexRT[Ch1] > 50 || vexRT[Ch1] < -50)
	{
		//point turn
		setDriveSpeed(vexRT[Ch1], -vexRT[Ch1]);
	}
	else
	{
		setDriveSpeed(0, 0);
	}
}

task main()
{
	while (true)
	{
		cataChooChoo();

		feedControl();

		driveControl();
	}
}
