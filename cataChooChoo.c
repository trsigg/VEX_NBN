#pragma config(Sensor, dgtl1,  chooEncoder,    sensorQuadEncoder)
#pragma config(Motor,  port1,           choo1,         tmotorVex393_HBridge, openLoop, reversed)
#pragma config(Motor,  port3,           dingus,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port4,           right1,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port5,           left1,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port6,           left2,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port7,           choo2,         tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port8,           wingus,        tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port10,          right2,        tmotorVex393_HBridge, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

void setFeedSpeed(int speed)
{
	motor[wingus] = speed;
	motor[dingus] = speed;
}

void setChooSpeed(int speed)
{
	motor[choo1] = speed;
	motor[choo2] = speed;
}

void setRightSpeed(int speed)
{
	motor[right1] = speed;
	motor[right2] = speed;
}

void setLeftSpeed(int speed)
{
	motor[left1] = speed;
	motor[left2] = speed;
}

void feedControl()
{
	if (vexRT[Btn6U]==1)
	{
		setFeedSpeed(127);
	}
	else if (vexRT[Btn6D]==1)
	{
		setFeedSpeed(-127);
	}
	else
	{
		setFeedSpeed(0);
	}
}

void cataChooChoo()
{
	int speed = 0;

	if (SensorValue[chooEncoder] > 1000)  //TODO: test actual encoder value after one launch and subtract ~5%
	{
		chooState = REST;
	}
	else if (chooState == REST && vexRT[Btn5U] == 1)
	{
		chooState = COCKING;
	}
	else if ((chooState == COCKING || chooState == MANUAL_OVERRIDE && SensorValue[chooEncoder] < 150) && SensorValue[chooEncoder] > 130)
	{
		chooState = READY;
	}
	else if (chooState == READY && vexRT[Btn5U] == 1)
	{
		chooState = FIRING;
	}
	else
	{
		chooState = REST;
	}

	if (vexRT[Btn5D] == 1)
	{
		chooState = MANUAL_OVERRIDE;
	}

	switch (chooState)
	{
		case REST:
			speed = 0;
			SensorValue[chooEncoder] = 0;
			break;
		case COCKING:
			speed = 127;
			break;
		case READY:
			speed = 20;
			break;
		case FIRING:
			speed = 127;
			break;
		case MANUAL_OVERRIDE:
			speed = 127;
			break;
		default:
			speed = 0;
	}

	setChooSpeed(speed);
}

task main()
{
	enum catapultState { REST, COCKING, READY, FIRING, MANUAL_OVERRIDE };
	catapultState chooState = REST;

	while (true)
	{
		cataChooChoo();

		feedControl();

		//drive control
		setRightSpeed(vexRT[Ch2]);
		setLeftSpeed(vexRT[Ch3]);
	}
}
